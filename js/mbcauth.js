function MBCAuth(){var d=new BigInteger(32,new SecureRandom());var e=false;var g=false;if(Browser.Engine.trident&&Browser.Engine.version==5){document.id("rsa_generator").removeClass("loading");document.id("rsa_generator").removeClass("hide");document.id("rsa_generator").set("html",'<span class="error">Internet Explorer V7 is not supported.  Chat will work with Internet Explorer 6 and 8 as well as Firefox, Chrome, Safari and Opera.</span>');return}function b(){if(!e){document.id("rsa_generator").removeClass("loading");document.id("rsa_generator").removeClass("hide");document.id("rsa_generator").set("html",'<span class="error">Security Alert, Server NOT confirmed.  Please notify security</span>')}}var f=function(h){document.id("rsa_generator").addClass("hide");document.id("authblock").removeClass("hide");document.id("login_error").removeClass("hide");if(h){document.id(document.id("login").username).addClass("error");document.id(document.id("login").password).addClass("error")}else{document.id(document.id("login").password).addClass("error")}};var a=new Request.JSON({url:"login/index.php",link:"chain",onComplete:function(h,i){if(h&&h.status){if(h.trial){if(h.trial==d.toString(10)){e=true;coordinator.done("verify",{});a.post.delay(1,this,{user:"$$#",pass:remoteKey})}else{b()}}else{if(h.login&&e){if(h.login.uid==0){g=true;document.id("rsa_generator").addClass("hide");document.id("authblock").removeClass("hide")}else{loginRequestOptions=h.login;coordinator.done("login",{})}}}}else{if(g){f(h.usererror)}}}});var c=d.modPow(new BigInteger(rsaExponent),new BigInteger(rsaModulus));window.addEvent("domready",function(){document.id("login").addEvent("submit",function(j){j.stop();var i={};i.U=document.id("login").username.value;i.P=document.id("login").password.value;if(i.U.contains("$")){f(false);return}if(i.P==""){if(!guestsAllowed){f(false);return}i.P="guest";i.U="$$G"+i.U}var h=(Math.ceil(new Date().getTime()/100000)*100).toString();while(h.length<10){h="0"+h}document.id("rsa_generator").removeClass("hide");document.id("authblock").addClass("hide");document.id("login_error").addClass("hide");document.id(document.id("login").username).removeClass("error");document.id(document.id("login").password).removeClass("error");a.post({user:i.U,pass:hex_md5(i.P+h)})});a.post({user:"$$$",pass:remoteKey,trial:c.toString(10)});b.delay(10000);coordinator.done("dom",{})})};

